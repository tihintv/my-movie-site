<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trang Admin — Quản lý phim</title>
  <style>
    body { margin:0; font-family: system-ui, sans-serif; background:#0b0d10; color:#e8eef5; }
    .container { max-width:600px; margin:20px auto; background:#11151b; padding:20px; border-radius:12px; }
    h1 { text-align:center; margin-bottom:20px; }
    form { display:flex; flex-direction:column; gap:10px; }
    input, textarea { padding:10px; border-radius:8px; border:1px solid #1c222b; background:#0b0d10; color:#e8eef5; }
    button { padding:10px; border:none; border-radius:8px; background:#6ea8fe; color:white; font-weight:700; cursor:pointer; }
    table { width:100%; margin-top:20px; border-collapse:collapse; }
    th, td { border:1px solid #1c222b; padding:8px; text-align:left; }
    th { background:#1b2838; }
    td button { margin-right:6px; padding:4px 8px; font-size:12px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Trang Admin — Quản lý phim</h1>
    <form id="movieForm">
      <input id="title" placeholder="Tên phim" required />
      <input id="year" placeholder="Năm phát hành" required />
      <input id="genres" placeholder="Thể loại (cách nhau bằng dấu phẩy)" />
      <input id="poster" placeholder="Poster URL (https://...)" />
      <input id="video" placeholder="Video URL (YouTube, Vimeo, direct link...)" />
      <textarea id="desc" placeholder="Mô tả"></textarea>
      <button type="submit">Lưu phim</button>
    </form>

    <table id="moviesTable">
      <thead>
        <tr>
          <th>Tên phim</th>
          <th>Năm</th>
          <th>Thể loại</th>
          <th>Video</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const STORAGE_KEY = "movies";
    let movies = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    let editIndex = -1;

    function saveMovies() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(movies));
    }

    function renderTable() {
      const tbody = document.querySelector("#moviesTable tbody");
      tbody.innerHTML = "";
      movies.forEach((m, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${m.title}</td>
          <td>${m.year}</td>
          <td>${Array.isArray(m.genres) ? m.genres.join(", ") : ""}</td>
          <td>${m.videoUrl ? `<a href="${m.videoUrl}" target="_blank">Xem</a>` : ""}</td>
          <td>
            <button onclick="editMovie(${idx})">Sửa</button>
            <button onclick="deleteMovie(${idx})">Xóa</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById("movieForm").addEventListener("submit", e => {
      e.preventDefault();
      const titleEl = document.getElementById("title");
      const yearEl = document.getElementById("year");
      const genresEl = document.getElementById("genres");
      const posterEl = document.getElementById("poster");
      const videoEl = document.getElementById("video");
      const descEl = document.getElementById("desc");

      const movie = {
        id: Date.now(),
        title: titleEl.value.trim(),
        year: yearEl.value.trim(),
        genres: genresEl.value.split(",").map(g => g.trim()).filter(Boolean),
        poster: posterEl.value.trim(),
        videoUrl: videoEl.value.trim(),
        description: descEl.value.trim()
      };

      if (editIndex >= 0) {
        movies[editIndex] = movie;
        editIndex = -1;
      } else {
        movies.push(movie);
      }

      saveMovies();
      renderTable();
      e.target.reset();
    });

    function editMovie(idx) {
      const m = movies[idx];
      document.getElementById("title").value = m.title;
      document.getElementById("year").value = m.year;
      document.getElementById("genres").value = m.genres.join(", ");
      document.getElementById("poster").value = m.poster;
      document.getElementById("video").value = m.videoUrl || "";
      document.getElementById("desc").value = m.description;
      editIndex = idx;
    }

    function deleteMovie(idx) {
      movies.splice(idx, 1);
      saveMovies();
      renderTable();
    }

    renderTable();
  </script>
</body>
</html>
