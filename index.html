<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>WebPhim</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0d0f12; color: white; margin: 0; }
    header { display: flex; align-items: center; justify-content: space-between; padding: 10px 20px; background: #111; }
    .logo { font-weight: bold; font-size: 20px; display: flex; align-items: center; gap: 8px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; padding: 20px; }
    .card { background: #1a1d24; border-radius: 12px; overflow: hidden; cursor: pointer; }
    .poster { width: 100%; aspect-ratio: 2/3; object-fit: cover; background: #333; }
    .content { padding: 10px; }
    .title { font-size: 16px; font-weight: bold; margin: 0; }
    .chips { margin: 5px 0; display: flex; flex-wrap: wrap; gap: 5px; }
    .chip { background: #222; padding: 3px 8px; border-radius: 12px; font-size: 12px; }
    .search { background: #111; border: 1px solid #333; padding: 8px; border-radius: 5px; color: white; }
    .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; }
    .modal-content { background: #1a1d24; padding: 20px; border-radius: 10px; max-width: 600px; width: 100%; }
    .modal-content img { width: 150px; float: left; margin-right: 20px; border-radius: 8px; }
    .close { float: right; cursor: pointer; font-size: 20px; }
    .episodes { margin-top: 20px; clear: both; }
    .episodes button { display: block; margin: 5px 0; padding: 8px; width: 100%; background: #4a90e2; border: none; color: white; border-radius: 5px; cursor: pointer; text-align: left; }
  </style>
</head>
<body>
  <header>
    <div class="logo">ðŸŽ¬ WebPhim</div>
    <input id="search" class="search" type="text" placeholder="TÃ¬m theo tÃªn, thá»ƒ loáº¡i...">
  </header>
  <main>
    <div id="movieGrid" class="grid"></div>
  </main>

  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <img id="modalPoster" src="">
      <h2 id="modalTitle"></h2>
      <p id="modalYear"></p>
      <div id="modalGenres"></div>
      <button id="playButton" style="display:none;">â–¶ Xem phim</button>
      <div id="modalEpisodes" class="episodes"></div>
      <p id="modalDesc"></p>
      <div id="videoPlayer" style="margin-top:15px;"></div>
    </div>
  </div>

  <script>
    const movieGrid = document.getElementById("movieGrid");
    const searchInput = document.getElementById("search");
    const modal = document.getElementById("modal");
    const modalPoster = document.getElementById("modalPoster");
    const modalTitle = document.getElementById("modalTitle");
    const modalYear = document.getElementById("modalYear");
    const modalGenres = document.getElementById("modalGenres");
    const playButton = document.getElementById("playButton");
    const modalDesc = document.getElementById("modalDesc");
    const modalEpisodes = document.getElementById("modalEpisodes");
    const videoPlayer = document.getElementById("videoPlayer");

    function loadMovies() {
      return JSON.parse(localStorage.getItem("movies")) || [];
    }

    function renderMovies(filter="") {
      const movies = loadMovies().filter(m => 
        m.title.toLowerCase().includes(filter) || 
        m.genres.join(" ").toLowerCase().includes(filter)
      );

      movieGrid.innerHTML = movies.map(m => `
        <article class="card" onclick="openModal(${m.id})">
          <img class="poster" src="${m.poster.startsWith('http') ? m.poster : './' + m.poster}" 
            alt="${m.title}" 
            onerror="this.src='https://placehold.co/300x450?text=${encodeURIComponent(m.title)}'">
          <div class="content">
            <h3 class="title">${m.title}</h3>
            <div class="chips">${m.genres.map(g => `<span class="chip">${g}</span>`).join("")}</div>
            <div class="meta">${m.year}</div>
          </div>
        </article>
      `).join("");
    }

    function openModal(id) {
      const movie = loadMovies().find(m => m.id === id);
      if (!movie) return;

      modalPoster.src = movie.poster.startsWith('http') ? movie.poster : './' + movie.poster;
      modalTitle.textContent = movie.title;
      modalYear.textContent = "NÄƒm phÃ¡t hÃ nh: " + movie.year;
      modalGenres.innerHTML = movie.genres.map(g => `<span class="chip">${g}</span>`).join("");
      modalDesc.textContent = movie.description || "";
      playButton.style.display = movie.videoUrl ? "block" : "none";
      playButton.onclick = () => playVideo(movie.videoUrl);

      // render danh sÃ¡ch táº­p
      modalEpisodes.innerHTML = "";
      if (movie.episodes && movie.episodes.length > 0) {
        movie.episodes.forEach(ep => {
          const btn = document.createElement("button");
          btn.textContent = ep.name;
          btn.onclick = () => playVideo(ep.url);
          modalEpisodes.appendChild(btn);
        });
      }

      modal.style.display = "flex";
    }

    function closeModal() {
      modal.style.display = "none";
      videoPlayer.innerHTML = "";
    }

    function playVideo(url) {
      let embed = "";
      if (url.includes("youtube.com") || url.includes("youtu.be")) {
        const id = url.split("v=")[1]?.split("&")[0] || url.split("/").pop();
        embed = `<iframe width="100%" height="315" src="https://www.youtube.com/embed/${id}" frameborder="0" allowfullscreen></iframe>`;
      } else if (url.includes("vimeo.com")) {
        const id = url.split("/").pop();
        embed = `<iframe src="https://player.vimeo.com/video/${id}" width="100%" height="315" frameborder="0" allowfullscreen></iframe>`;
      } else {
        embed = `<video controls width="100%"><source src="${url}" type="video/mp4"></video>`;
      }
      videoPlayer.innerHTML = embed;
    }

    searchInput.addEventListener("input", e => renderMovies(e.target.value.toLowerCase()));
    renderMovies();
  </script>
</body>
</html>
