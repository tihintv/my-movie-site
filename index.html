<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebPhim</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background-color: #111; color: white; }
    header { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background-color: #000; position: sticky; top: 0; z-index: 10; }
    header h1 { font-size: 20px; display: flex; align-items: center; }
    header h1::before { content: "üé¨"; margin-right: 8px; }
    #searchInput { padding: 8px 12px; border-radius: 5px; border: none; outline: none; background-color: #1c1c1c; color: white; }
    .movie-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; padding: 20px; }
    .movie { background: #1a1a1a; border-radius: 10px; overflow: hidden; cursor: pointer; transition: transform 0.2s; }
    .movie:hover { transform: scale(1.05); }
    .movie img { width: 100%; height: 250px; object-fit: cover; display: block; }
    .movie-info { padding: 10px; }
    .movie-info h3 { margin: 0; font-size: 16px; }
    .tag { display: inline-block; background: #222; padding: 2px 8px; border-radius: 5px; margin-top: 5px; font-size: 12px; }
    .modal { display: none; position: fixed; z-index: 20; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); justify-content: center; align-items: center; }
    .modal-content { background: #1c1c1c; padding: 20px; border-radius: 10px; width: 90%; max-width: 700px; display: flex; gap: 20px; position: relative; }
    .modal-content img { width: 200px; border-radius: 10px; object-fit: cover; }
    .modal-info { flex: 1; }
    .close { position: absolute; top: 10px; right: 15px; font-size: 22px; cursor: pointer; }
    .watch-btn { display: inline-block; margin-top: 10px; padding: 8px 15px; background: #3b82f6; border-radius: 5px; color: white; text-decoration: none; }
    .episodes { margin-top: 15px; }
    .episodes h4 { margin: 5px 0; }
  </style>
</head>
<body>
  <header>
    <h1>WebPhim</h1>
    <input type="text" id="searchInput" placeholder="T√¨m theo t√™n, th·ªÉ lo·∫°i...">
  </header>

  <div class="movie-list" id="movieList"></div>

  <!-- Popup -->
  <div id="movieModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <img id="modalPoster" src="" alt="Poster">
      <div class="modal-info">
        <h2 id="modalTitle"></h2>
        <p><strong>NƒÉm ph√°t h√†nh:</strong> <span id="modalYear"></span></p>
        <div id="modalGenres"></div>
        <a id="watchBtn" class="watch-btn" target="_blank">‚ñ∂ Xem phim</a>
        <div class="episodes">
          <h4>S·ªë t·∫≠p:</h4>
          <ul id="episodeList"></ul>
        </div>
        <p id="modalDesc"></p>
      </div>
    </div>
  </div>

  <script>
    const movieListEl = document.getElementById("movieList");
    const searchInput = document.getElementById("searchInput");

    const movies = JSON.parse(localStorage.getItem("movies")) || [];

    function renderMovies(list) {
      movieListEl.innerHTML = "";
      list.forEach(movie => {
        const div = document.createElement("div");
        div.className = "movie";
        div.innerHTML = `
          <img src="${movie.poster}" alt="${movie.title}" 
               onerror="this.src='https://via.placeholder.com/200x300?text=${movie.title}'">
          <div class="movie-info">
            <h3>${movie.title}</h3>
            <span class="tag">${movie.genres.join(", ")}</span>
            <p>${movie.year}</p>
          </div>
        `;
        div.addEventListener("click", () => openModal(movie));
        movieListEl.appendChild(div);
      });
    }

    function openModal(movie) {
      document.getElementById("modalPoster").src = movie.poster;
      document.getElementById("modalTitle").textContent = movie.title;
      document.getElementById("modalYear").textContent = movie.year;
      document.getElementById("modalGenres").innerHTML = movie.genres.map(g => `<span class="tag">${g}</span>`).join(" ");
      document.getElementById("modalDesc").textContent = movie.description || "";

      const episodeList = document.getElementById("episodeList");
      episodeList.innerHTML = "";
      if (movie.episodes && movie.episodes.length > 0) {
        movie.episodes.forEach((ep, i) => {
          const li = document.createElement("li");
          li.innerHTML = `<a href="${ep.url}" target="_blank">${ep.name || "T·∫≠p " + (i+1)}</a>`;
          episodeList.appendChild(li);
        });
      } else {
        episodeList.innerHTML = "<li>Ch∆∞a c√≥ th√¥ng tin s·ªë t·∫≠p</li>";
      }

      const watchBtn = document.getElementById("watchBtn");
      if (movie.videoUrl) {
        watchBtn.href = movie.videoUrl;
        watchBtn.style.display = "inline-block";
      } else {
        watchBtn.style.display = "none";
      }

      document.getElementById("movieModal").style.display = "flex";
    }

    document.getElementById("closeModal").onclick = () => {
      document.getElementById("movieModal").style.display = "none";
    };

    searchInput.addEventListener("input", () => {
      const keyword = searchInput.value.toLowerCase();
      const filtered = movies.filter(m =>
        m.title.toLowerCase().includes(keyword) ||
        m.genres.join(", ").toLowerCase().includes(keyword)
      );
      renderMovies(filtered);
    });

    renderMovies(movies);
  </script>
</body>
</html>
